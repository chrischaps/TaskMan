# TaskMan Backend

Backend API server for TaskMan - a multiplayer task completion game.

## Current Status

**Phase 1: Foundation - In Progress**

- ✅ BE-001: Initialize Node.js + Express project
- ✅ BE-002: Configure TypeScript
- ✅ BE-003: Setup Prisma with PostgreSQL schema
- ⏳ BE-004: Setup local PostgreSQL with Docker

## Setup

```bash
# Install dependencies
npm install

# Copy environment variables
cp .env.example .env

# Start development server
npm run dev

# Start production server
npm start
```

## Available Scripts

- `npm run dev` - Start development server with nodemon + ts-node (auto-reload)
- `npm run build` - Compile TypeScript to JavaScript (output to dist/)
- `npm run build:watch` - Compile TypeScript in watch mode
- `npm start` - Start production server (requires build first)
- `npm run clean` - Remove compiled dist/ folder
- `npm run prisma:generate` - Generate Prisma Client
- `npm run prisma:studio` - Open Prisma Studio (GUI for database)
- `npm run prisma:format` - Format Prisma schema
- `npm test` - Run tests (not yet implemented)

## API Endpoints

### Currently Available

- `GET /` - API server status
- `GET /api/health` - Health check endpoint

### Coming Soon (Phase 1-2)

- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `GET /api/auth/me` - Get current user
- `GET /api/tasks` - List available tasks
- `POST /api/tasks` - Create new task
- `POST /api/tasks/:id/accept` - Accept a task
- `POST /api/tasks/:id/submit` - Submit task solution

## Project Structure

```
backend/
├── src/
│   ├── server.ts          # Main Express application (TypeScript)
│   └── lib/
│       └── prisma.ts      # Prisma Client singleton
├── prisma/
│   ├── schema.prisma      # Database schema
│   └── migrations/        # Database migrations (generated)
├── dist/                   # Compiled JavaScript (generated by build)
├── .env                    # Environment variables (not committed)
├── .env.example            # Example environment variables
├── tsconfig.json           # TypeScript configuration
├── prisma.config.ts        # Prisma configuration
├── package.json            # Dependencies and scripts
└── README.md               # This file
```

## Technology Stack

- **Runtime:** Node.js 22+
- **Language:** TypeScript 5.9+
- **Framework:** Express 5.1
- **ORM:** Prisma 6.18
- **Database:** PostgreSQL 15+
- **Type Definitions:** @types/node, @types/express, @types/cors

## Database Schema

The database includes 5 main models:
- **User** - Authentication, token balance, progression flags
- **Task** - All task types with JSONB data and solution fields
- **CompositeSubtask** - Links composite tasks to their subtasks
- **TokenTransaction** - Audit trail for token changes
- **TaskSubmission** - Tracks task attempts and validation results

See `prisma/schema.prisma` for the complete schema.

## Environment Variables

See `.env.example` for required environment variables.

## Development

Server runs on `http://localhost:3001` by default.

CORS is enabled for frontend development (will run on `http://localhost:5173`).
